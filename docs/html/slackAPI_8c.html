<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ERTbot: src/slackAPI.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ERTbot
   </div>
   <div id="projectbrief">Bot used to automate and enhance certain processes at the EPFL Rocket Team</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">slackAPI.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="struct_8h_source.html">../include/struct.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="api_8h_source.html">../include/api.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="config_8h_source.html">../include/config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="features_8h_source.html">../include/features.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="githubAPI_8h_source.html">../include/githubAPI.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="helperFunctions_8h_source.html">../include/helperFunctions.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="markdownToPDF_8h_source.html">../include/markdownToPDF.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="slackAPI_8h_source.html">../include/slackAPI.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="stringTools_8h_source.html">../include/stringTools.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="wikiAPI_8h_source.html">../include/wikiAPI.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="sheetAPI_8h_source.html">../include/sheetAPI.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for slackAPI.c:</div>
<div class="dyncontent">
<div class="center"><img src="slackAPI_8c__incl.png" border="0" usemap="#asrc_2slackAPI_8c" alt=""/></div>
</div>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab234d1358562b66925fb7223c087556b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="slackAPI_8c.html#ab234d1358562b66925fb7223c087556b">MAX_MESSAGE_LENGTH</a>&#160;&#160;&#160;100000</td></tr>
<tr class="separator:ab234d1358562b66925fb7223c087556b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a90042dd89b9992538ab4530622e94895"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="slackAPI_8c.html#a90042dd89b9992538ab4530622e94895">sendMessageToSlack</a> (char *message)</td></tr>
<tr class="memdesc:a90042dd89b9992538ab4530622e94895"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends a message to a specified Slack channel using the Slack API.  <a href="slackAPI_8c.html#a90042dd89b9992538ab4530622e94895">More...</a><br /></td></tr>
<tr class="separator:a90042dd89b9992538ab4530622e94895"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0115794b93c780ff616402c121925181"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="slackAPI_8c.html#a0115794b93c780ff616402c121925181">checkLastSlackMessage</a> ()</td></tr>
<tr class="memdesc:a0115794b93c780ff616402c121925181"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks the last message sent in a specified Slack channel by fetching the conversation history.  <a href="slackAPI_8c.html#a0115794b93c780ff616402c121925181">More...</a><br /></td></tr>
<tr class="separator:a0115794b93c780ff616402c121925181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c52746377668b0750e43e1ba226da47"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structslackMessage.html">slackMessage</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="slackAPI_8c.html#a7c52746377668b0750e43e1ba226da47">getSlackMessage</a> (<a class="el" href="structslackMessage.html">slackMessage</a> slackMsg)</td></tr>
<tr class="memdesc:a7c52746377668b0750e43e1ba226da47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the most recent message from a Slack channel and populates a <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct with its details.  <a href="slackAPI_8c.html#a7c52746377668b0750e43e1ba226da47">More...</a><br /></td></tr>
<tr class="separator:a7c52746377668b0750e43e1ba226da47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6282108b5de0cea6ca865e620424e8f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="slackAPI_8c.html#af6282108b5de0cea6ca865e620424e8f">addSlackMember</a> (char *channels, char *email)</td></tr>
<tr class="memdesc:af6282108b5de0cea6ca865e620424e8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invites a user to one or more Slack channels using the Slack API.  <a href="slackAPI_8c.html#af6282108b5de0cea6ca865e620424e8f">More...</a><br /></td></tr>
<tr class="separator:af6282108b5de0cea6ca865e620424e8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><dl class="section author"><dt>Author</dt><dd>Ryan Svoboda (<a href="#" onclick="location.href='mai'+'lto:'+'rya'+'n.'+'svo'+'bo'+'da@'+'ep'+'fl.'+'ch'; return false;">ryan.<span style="display: none;">.nosp@m.</span>svob<span style="display: none;">.nosp@m.</span>oda@e<span style="display: none;">.nosp@m.</span>pfl.<span style="display: none;">.nosp@m.</span>ch</a>)</dd></dl>
<p>Contains all of the functions which are only used to interact with the Slack APIs. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab234d1358562b66925fb7223c087556b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab234d1358562b66925fb7223c087556b">&#9670;&nbsp;</a></span>MAX_MESSAGE_LENGTH</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_MESSAGE_LENGTH&#160;&#160;&#160;100000</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="af6282108b5de0cea6ca865e620424e8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6282108b5de0cea6ca865e620424e8f">&#9670;&nbsp;</a></span>addSlackMember()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int addSlackMember </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>channels</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>email</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Invites a user to one or more Slack channels using the Slack API. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">channels</td><td>A comma-separated list of Slack channel IDs to which the user will be invited. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">email</td><td>The email address of the user to invite.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and 1 on failure.</dd></dl>
<p>This function sends a POST request to the Slack API to invite a user to specified channels. The request payload is formatted as JSON and includes the channel IDs, user email, and team ID. The function handles setting the required HTTP headers, including the authorization token. If the request fails or if libcurl initialization fails, the function returns 1. On success, it returns 0.</p>
<dl class="section note"><dt>Note</dt><dd>The function assumes that the environment variable <code>SLACK_API_TOKEN</code> is set with the Slack API token, and that <code>SLACK_API_TOKEN</code> is valid. The maximum JSON payload length is defined by <code>2000</code> bytes.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>This function has not been tested yet and is not integrated into the program yet</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000011">Todo:</a></b></dt><dd>Test the assSlackMember function and integrate with the rest of the program </dd></dl>

</div>
</div>
<a id="a0115794b93c780ff616402c121925181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0115794b93c780ff616402c121925181">&#9670;&nbsp;</a></span>checkLastSlackMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void checkLastSlackMessage </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks the last message sent in a specified Slack channel by fetching the conversation history. </p>
<p>This function sends a GET request to the Slack API to retrieve the most recent message from a specific Slack channel. The request URL is constructed using the channel ID and a limit of 1 message. The response is handled by the <code>writeCallback</code> function, which stores the result in a memory buffer. The function also checks for any errors in the HTTP request and verifies the HTTP status code. Resources are cleaned up after the request is completed.</p>
<dl class="section note"><dt>Note</dt><dd>The function assumes that the environment variables <code>SLACK_API_TOKEN</code> and <code>SLACK_WIKI_TOOLBOX_CHANNEL</code> are set with the appropriate values. The function uses a global variable <code>chunk</code> of type <code>struct memory</code> to store the response data. </dd></dl>

</div>
</div>
<a id="a7c52746377668b0750e43e1ba226da47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c52746377668b0750e43e1ba226da47">&#9670;&nbsp;</a></span>getSlackMessage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structslackMessage.html">slackMessage</a> getSlackMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structslackMessage.html">slackMessage</a>&#160;</td>
          <td class="paramname"><em>slackMsg</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the most recent message from a Slack channel and populates a <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct with its details. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">slackMsg</td><td>A <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct that will be populated with the message details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a> The populated <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct containing the message text, sender ID, and timestamp.</dd></dl>
<p>This function calls <code><a class="el" href="slackAPI_8h.html#a0115794b93c780ff616402c121925181" title="Checks the last message sent in a specified Slack channel by fetching the conversation history.">checkLastSlackMessage()</a></code> to retrieve the latest message from a Slack channel. It then parses the JSON response to extract the message text, sender ID, and timestamp using the <code><a class="el" href="api_8h.html#aa887627dcb425dc87222f40830de1026" title="Parses a JSON string to extract the value associated with a given key.">jsonParserGetStringValue()</a></code> function. These values are assigned to the corresponding fields of the <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct passed to the function. The response memory buffer is freed after parsing.</p>
<dl class="section note"><dt>Note</dt><dd>The function assumes that <code>chunk.response</code> contains the JSON response from Slack, and that the <code><a class="el" href="structslackMessage.html" title="Structure to store information about a Slack message.">slackMessage</a></code> struct has fields for <code>message</code>, <code>sender</code>, and <code>timestamp</code> that are of type <code>char*</code>. </dd></dl>

</div>
</div>
<a id="a90042dd89b9992538ab4530622e94895"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a90042dd89b9992538ab4530622e94895">&#9670;&nbsp;</a></span>sendMessageToSlack()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sendMessageToSlack </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>message</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends a message to a specified Slack channel using the Slack API. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">message</td><td>Pointer to the string containing the message to be sent.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>int Returns 0 on success and 1 on failure.</dd></dl>
<p>This function sends a POST request to the Slack API to post a message to a specific channel. The message is formatted as a JSON payload and includes the channel ID and text of the message. The function sets up the necessary HTTP headers, including the authorization token, and sends the request using libcurl. If the request fails or if the libcurl initialization fails, the function returns 1. On success, it returns 0.</p>
<dl class="section note"><dt>Note</dt><dd>The function assumes that the environment variable <code>SLACK_API_TOKEN</code> is set with the Slack API token, and that <code>SLACK_WIKI_TOOLBOX_CHANNEL</code> contains the channel ID. The maximum message length is defined by <code>MAX_MESSAGE_LENGTH</code>. </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
